# PrimeEra | FS | L1 Interview Questions & Answers

## Table of Contents
1. [Angular component communication](#1-can-you-tell-me-how-we-communicate-between-angular-components)
2. [Subject and BehaviorSubject](#2-what-is-subject-and-behavioral-subject-why-we-need)
3. [Handle errors globally](#3-how-do-you-handle-errors-globally)
4. [Store JWT token in Angular](#4-where-do-you-store-the-jwt-token-in-angular)
5. [Pass JWT token](#5-how-do-you-pass-jwt-token)
6. [SQL 4th highest salary](#6-write-a-sql-4th-highest-salary-in-employee-table)
7. [Implement JWT in .NET Core](#7-how-do-you-implement-jwt-in-net-core)
8. [Project and roles](#8-can-you-tell-me-about-your-project-and-roles-and-responsibilities)
9. [Angular date programming](#9-write-a-angular-programming-to-print-today-date-in-view-and-implement-a-button-if-click-on-button-will-have-to-next-day-date)
10. [SQL delete duplicate records](#10-write-a-sql-query-to-delete-duplicate-records-from-a-table-employee)
11. [IEnumerable vs IQueryable](#11-what-is-difference-between-ienumerable-vs-iqueryable)
12. [Use of OData](#12-what-is-the-use-of-odata)
13. [Implement pagination](#13-how-would-you-implement-pagination)
14. [Different types of forms](#14-what-are-different-types-of-forms-and-explain-those)
15. [Method overloading & overriding](#15-what-is-method-overloading--overriding)
16. [Entity Framework vs Dapper](#16-what-is-difference-between-entityframework-and-dapper)
17. [Why ORM in projects](#17-why-orm-in-our-projects)
18. [What is Observable](#18-what-is-an-observable)
19. [Stored procedure & functions](#19-what-is-stored-procedure--functions-in-sql)
20. [LINQ](#20-do-you-know-linq)
21. [Dependency Injection](#21-what-is-di)
22. [Multiple returns in method](#22-can-a-method-has-multiple-returns)
23. [What is tuple](#23-what-is-tuple)

---

## 1. Can you tell me how we communicate between angular components?

### 1. Parent to Child (@Input)
```typescript
// Parent Component
@Component({
  selector: 'app-parent',
  template: `
    <app-child [message]="parentMessage" [user]="currentUser"></app-child>
  `
})
export class ParentComponent {
  parentMessage = "Hello from Parent!";
  currentUser = { name: "John", age: 25 };
}

// Child Component
@Component({
  selector: 'app-child',
  template: `
    <div>
      <p>{{message}}</p>
      <p>User: {{user.name}}, Age: {{user.age}}</p>
    </div>
  `
})
export class ChildComponent {
  @Input() message: string;
  @Input() user: any;
}
```

### 2. Child to Parent (@Output & EventEmitter)
```typescript
// Child Component
@Component({
  selector: 'app-child',
  template: `
    <button (click)="sendData()">Send to Parent</button>
    <input [(ngModel)]="childMessage" placeholder="Enter message">
  `
})
export class ChildComponent {
  @Output() messageEvent = new EventEmitter<string>();
  childMessage = '';
  
  sendData() {
    this.messageEvent.emit(this.childMessage);
  }
}

// Parent Component
@Component({
  selector: 'app-parent',
  template: `
    <app-child (messageEvent)="receiveMessage($event)"></app-child>
    <p>Received: {{receivedMessage}}</p>
  `
})
export class ParentComponent {
  receivedMessage = '';
  
  receiveMessage(message: string) {
    this.receivedMessage = message;
  }
}
```

### 3. Service with BehaviorSubject
```typescript
// Shared Data Service
@Injectable({
  providedIn: 'root'
})
export class UserService {
  
  constructor(
    private http: HttpClient,
    private tokenService: TokenService
  ) {}
  
  getUsers(): Observable<User[]> {
    const headers = this.createAuthHeaders();
    return this.http.get<User[]>('/api/users', { headers });
  }
  
  createUser(user: User): Observable<User> {
    const headers = this.createAuthHeaders();
    return this.http.post<User>('/api/users', user, { headers });
  }
  
  updateUser(id: number, user: User): Observable<User> {
    const headers = this.createAuthHeaders();
    return this.http.put<User>(`/api/users/${id}`, user, { headers });
  }
  
  private createAuthHeaders(): HttpHeaders {
    const token = this.tokenService.getToken();
    return new HttpHeaders({
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json'
    });
  }
}
```

### 4. Using HTTP Client with Options
```typescript
@Injectable({
  providedIn: 'root'
})
export class ApiService {
  
  constructor(
    private http: HttpClient,
    private tokenService: TokenService
  ) {}
  
  private getHttpOptions() {
    const token = this.tokenService.getToken();
    return {
      headers: new HttpHeaders({
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json',
        'Accept': 'application/json'
      })
    };
  }
  
  getData<T>(url: string): Observable<T> {
    return this.http.get<T>(url, this.getHttpOptions());
  }
  
  postData<T>(url: string, data: any): Observable<T> {
    return this.http.post<T>(url, data, this.getHttpOptions());
  }
  
  putData<T>(url: string, data: any): Observable<T> {
    return this.http.put<T>(url, data, this.getHttpOptions());
  }
  
  deleteData<T>(url: string): Observable<T> {
    return this.http.delete<T>(url, this.getHttpOptions());
  }
}
```

### 5. Guard Integration
```typescript
@Injectable({
  providedIn: 'root'
})
export class AuthGuard implements CanActivate {
  
  constructor(
    private tokenService: TokenService,
    private router: Router
  ) {}
  
  canActivate(): boolean {
    const token = this.tokenService.getToken();
    
    if (token && !this.tokenService.isTokenExpired()) {
      return true;
    }
    
    this.router.navigate(['/login']);
    return false;
  }
}

// Route configuration
const routes: Routes = [
  {
    path: 'dashboard',
    component: DashboardComponent,
    canActivate: [AuthGuard]
  }
];
```

### 6. WebSocket Token Authentication
```typescript
@Injectable({
  providedIn: 'root'
})
export class WebSocketService {
  private socket: WebSocket | null = null;
  
  connect(): void {
    const token = this.tokenService.getToken();
    const wsUrl = `ws://localhost:8080?token=${token}`;
    
    this.socket = new WebSocket(wsUrl);
    
    this.socket.onopen = () => {
      console.log('WebSocket connected');
      // Send token in first message if needed
      this.socket?.send(JSON.stringify({
        type: 'auth',
        token: token
      }));
    };
    
    this.socket.onmessage = (event) => {
      const data = JSON.parse(event.data);
      console.log('Received:', data);
    };
  }
}
```

**[⬆ Back to Top](#table-of-contents)**

---

## 6. Write a SQL 4th highest salary in employee table

### Method 1: Using ROW_NUMBER() (Most Reliable)
```sql
SELECT salary
FROM (
    SELECT salary, 
           ROW_NUMBER() OVER (ORDER BY salary DESC) as row_num
    FROM employee
) ranked
WHERE row_num = 4;
```

### Method 2: Using LIMIT and OFFSET
```sql
-- For MySQL, PostgreSQL
SELECT DISTINCT salary 
FROM employee 
ORDER BY salary DESC 
LIMIT 1 OFFSET 3;

-- For SQL Server
SELECT salary
FROM employee
ORDER BY salary DESC
OFFSET 3 ROWS
FETCH NEXT 1 ROWS ONLY;
```

### Method 3: Using Subqueries
```sql
SELECT MAX(salary) as fourth_highest_salary
FROM employee 
WHERE salary < (
    SELECT MAX(salary) 
    FROM employee 
    WHERE salary < (
        SELECT MAX(salary) 
        FROM employee 
        WHERE salary < (
            SELECT MAX(salary) 
            FROM employee
        )
    )
);
```

### Method 4: Using DENSE_RANK() (Handles Duplicates)
```sql
SELECT salary
FROM (
    SELECT salary,
           DENSE_RANK() OVER (ORDER BY salary DESC) as rank_num
    FROM employee
) ranked
WHERE rank_num = 4;
```

### Method 5: Using Common Table Expression (CTE)
```sql
WITH RankedSalaries AS (
    SELECT salary,
           ROW_NUMBER() OVER (ORDER BY salary DESC) as rn
    FROM employee
)
SELECT salary
FROM RankedSalaries
WHERE rn = 4;
```

### Method 6: Generic Solution for Nth Highest
```sql
-- Get Nth highest salary (replace @N with desired rank)
DECLARE @N INT = 4;

SELECT salary
FROM (
    SELECT salary,
           ROW_NUMBER() OVER (ORDER BY salary DESC) as row_num
    FROM employee
) ranked
WHERE row_num = @N;
```

### Complete Example with Employee Table
```sql
-- Sample data
CREATE TABLE employee (
    id INT PRIMARY KEY,
    name VARCHAR(100),
    salary DECIMAL(10,2),
    department VARCHAR(50)
);

INSERT INTO employee VALUES
(1, 'John Doe', 75000.00, 'IT'),
(2, 'Jane Smith', 85000.00, 'HR'),
(3, 'Bob Johnson', 95000.00, 'IT'),
(4, 'Alice Brown', 65000.00, 'Finance'),
(5, 'Charlie Davis', 105000.00, 'IT'),
(6, 'Diana Wilson', 78000.00, 'HR'),
(7, 'Eve Miller', 90000.00, 'Finance');

-- Get 4th highest salary with employee details
SELECT e.id, e.name, e.salary, e.department
FROM employee e
WHERE e.salary = (
    SELECT salary
    FROM (
        SELECT DISTINCT salary,
               ROW_NUMBER() OVER (ORDER BY salary DESC) as rn
        FROM employee
    ) ranked
    WHERE rn = 4
);
```

### Advanced: Department-wise 4th Highest
```sql
-- Get 4th highest salary in each department
SELECT department, name, salary
FROM (
    SELECT department, name, salary,
           ROW_NUMBER() OVER (PARTITION BY department ORDER BY salary DESC) as rn
    FROM employee
) ranked
WHERE rn = 4;
```

### Error Handling Version
```sql
-- Handle case when there are less than 4 employees
SELECT 
    CASE 
        WHEN COUNT(*) >= 4 THEN
            (SELECT salary
             FROM (
                 SELECT salary,
                        ROW_NUMBER() OVER (ORDER BY salary DESC) as rn
                 FROM employee
             ) ranked
             WHERE rn = 4)
        ELSE NULL
    END as fourth_highest_salary
FROM employee;
```

**[⬆ Back to Top](#table-of-contents)**

---

## 7. How do you implement JWT in .NET Core?

### Step 1: Install Required NuGet Packages
```xml
<PackageReference Include="Microsoft.AspNetCore.Authentication.JwtBearer" Version="8.0.0" />
<PackageReference Include="System.IdentityModel.Tokens.Jwt" Version="7.0.0" />
```

### Step 2: Configure JWT in Program.cs (.NET 8)
```csharp
using Microsoft.AspNetCore.Authentication.JwtBearer;
using Microsoft.IdentityModel.Tokens;
using System.Text;

var builder = WebApplication.CreateBuilder(args);

// Add services
builder.Services.AddControllers();
builder.Services.AddEndpointsApiExplorer();
builder.Services.AddSwaggerGen();

// Configure JWT Authentication
builder.Services.AddAuthentication(options =>
{
    options.DefaultAuthenticateScheme = JwtBearerDefaults.AuthenticationScheme;
    options.DefaultChallengeScheme = JwtBearerDefaults.AuthenticationScheme;
})
.AddJwtBearer(options =>
{
    options.TokenValidationParameters = new TokenValidationParameters
    {
        ValidateIssuer = true,
        ValidateAudience = true,
        ValidateLifetime = true,
        ValidateIssuerSigningKey = true,
        ValidIssuer = builder.Configuration["Jwt:Issuer"],
        ValidAudience = builder.Configuration["Jwt:Audience"],
        IssuerSigningKey = new SymmetricSecurityKey(
            Encoding.UTF8.GetBytes(builder.Configuration["Jwt:SecretKey"])),
        ClockSkew = TimeSpan.Zero // Remove default 5 minute clock skew
    };
    
    // Handle JWT events
    options.Events = new JwtBearerEvents
    {
        OnAuthenticationFailed = context =>
        {
            Console.WriteLine($"Authentication failed: {context.Exception.Message}");
            return Task.CompletedTask;
        },
        OnTokenValidated = context =>
        {
            Console.WriteLine($"Token validated for: {context.Principal?.Identity?.Name}");
            return Task.CompletedTask;
        }
    };
});

builder.Services.AddAuthorization();

// Register custom services
builder.Services.AddScoped<IJwtTokenService, JwtTokenService>();
builder.Services.AddScoped<IUserService, UserService>();

var app = builder.Build();

// Configure pipeline
if (app.Environment.IsDevelopment())
{
    app.UseSwagger();
    app.UseSwaggerUI();
}

app.UseHttpsRedirection();
app.UseAuthentication();
app.UseAuthorization();
app.MapControllers();

app.Run();
```

### Step 3: JWT Configuration (appsettings.json)
```json
{
  "ConnectionStrings": {
    "DefaultConnection": "Server=.;Database=MyApp;Trusted_Connection=true;"
  },
  "Jwt": {
    "SecretKey": "your-super-secret-key-here-must-be-at-least-256-bits-long",
    "Issuer": "https://localhost:7001",
    "Audience": "https://localhost:7001",
    "ExpireMinutes": 60,
    "RefreshTokenExpireDays": 30
  },
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  }
}
```

### Step 4: JWT Token Service
```csharp
public interface IJwtTokenService
{
    string GenerateAccessToken(User user);
    string GenerateRefreshToken();
    ClaimsPrincipal GetPrincipalFromExpiredToken(string token);
    bool ValidateToken(string token);
}

public class JwtTokenService : IJwtTokenService
{
    private readonly IConfiguration _configuration;
    private readonly SymmetricSecurityKey _key;

    public JwtTokenService(IConfiguration configuration)
    {
        _configuration = configuration;
        _key = new SymmetricSecurityKey(
            Encoding.UTF8.GetBytes(_configuration["Jwt:SecretKey"]!));
    }

    public string GenerateAccessToken(User user)
    {
        var claims = new List<Claim>
        {
            new Claim(ClaimTypes.NameIdentifier, user.Id.ToString()),
            new Claim(ClaimTypes.Name, user.Username),
            new Claim(ClaimTypes.Email, user.Email),
            new Claim(JwtRegisteredClaimNames.Jti, Guid.NewGuid().ToString()),
            new Claim(JwtRegisteredClaimNames.Iat, 
                new DateTimeOffset(DateTime.UtcNow).ToUnixTimeSeconds().ToString(), 
                ClaimValueTypes.Integer64)
        };

        // Add role claims
        foreach (var role in user.Roles)
        {
            claims.Add(new Claim(ClaimTypes.Role, role));
        }

        var credentials = new SigningCredentials(_key, SecurityAlgorithms.HmacSha256);
        var expires = DateTime.UtcNow.AddMinutes(
            Convert.ToDouble(_configuration["Jwt:ExpireMinutes"]));

        var token = new JwtSecurityToken(
            issuer: _configuration["Jwt:Issuer"],
            audience: _configuration["Jwt:Audience"],
            claims: claims,
            expires: expires,
            signingCredentials: credentials
        );

        return new JwtSecurityTokenHandler().WriteToken(token);
    }

    public string GenerateRefreshToken()
    {
        var randomNumber = new byte[64];
        using var rng = RandomNumberGenerator.Create();
        rng.GetBytes(randomNumber);
        return Convert.ToBase64String(randomNumber);
    }

    public ClaimsPrincipal GetPrincipalFromExpiredToken(string token)
    {
        var tokenValidationParameters = new TokenValidationParameters
        {
            ValidateAudience = false,
            ValidateIssuer = false,
            ValidateIssuerSigningKey = true,
            IssuerSigningKey = _key,
            ValidateLifetime = false // Don't validate expiration
        };

        var tokenHandler = new JwtSecurityTokenHandler();
        var principal = tokenHandler.ValidateToken(token, tokenValidationParameters, out SecurityToken securityToken);

        if (securityToken is not JwtSecurityToken jwtSecurityToken || 
            !jwtSecurityToken.Header.Alg.Equals(SecurityAlgorithms.HmacSha256, StringComparison.InvariantCultureIgnoreCase))
        {
            throw new SecurityTokenException("Invalid token");
        }

        return principal;
    }

    public bool ValidateToken(string token)
    {
        try
        {
            var tokenHandler = new JwtSecurityTokenHandler();
            var validationParameters = new TokenValidationParameters
            {
                ValidateIssuerSigningKey = true,
                IssuerSigningKey = _key,
                ValidateIssuer = true,
                ValidIssuer = _configuration["Jwt:Issuer"],
                ValidateAudience = true,
                ValidAudience = _configuration["Jwt:Audience"],
                ValidateLifetime = true,
                ClockSkew = TimeSpan.Zero
            };

            tokenHandler.ValidateToken(token, validationParameters, out SecurityToken validatedToken);
            return true;
        }
        catch
        {
            return false;
        }
    }
}
```

### Step 5: User Models and DTOs
```csharp
public class User
{
    public int Id { get; set; }
    public string Username { get; set; } = string.Empty;
    public string Email { get; set; } = string.Empty;
    public string PasswordHash { get; set; } = string.Empty;
    public List<string> Roles { get; set; } = new();
    public string? RefreshToken { get; set; }
    public DateTime? RefreshTokenExpiry { get; set; }
    public DateTime CreatedAt { get; set; }
    public DateTime? LastLoginAt { get; set; }
}

public record LoginRequest(string Email, string Password);
public record RegisterRequest(string Username, string Email, string Password);

public record AuthResponse(
    string AccessToken, 
    string RefreshToken, 
    DateTime Expires, 
    UserDto User);

public record UserDto(int Id, string Username, string Email, List<string> Roles);

public record RefreshTokenRequest(string AccessToken, string RefreshToken);
```

### Step 6: Authentication Controller
```csharp
[ApiController]
[Route("api/[controller]")]
public class AuthController : ControllerBase
{
    private readonly IJwtTokenService _tokenService;
    private readonly IUserService _userService;
    private readonly ILogger<AuthController> _logger;

    public AuthController(
        IJwtTokenService tokenService,
        IUserService userService,
        ILogger<AuthController> logger)
    {
        _tokenService = tokenService;
        _userService = userService;
        _logger = logger;
    }

    [HttpPost("login")]
    public async Task<IActionResult> Login([FromBody] LoginRequest request)
    {
        try
        {
            var user = await _userService.ValidateUserAsync(request.Email, request.Password);
            if (user == null)
            {
                return Unauthorized(new { message = "Invalid email or password" });
            }

            var accessToken = _tokenService.GenerateAccessToken(user);
            var refreshToken = _tokenService.GenerateRefreshToken();

            // Save refresh token
            await _userService.SaveRefreshTokenAsync(user.Id, refreshToken);

            var response = new AuthResponse(
                AccessToken: accessToken,
                RefreshToken: refreshToken,
                Expires: DateTime.UtcNow.AddMinutes(60),
                User: new UserDto(user.Id, user.Username, user.Email, user.Roles)
            );

            _logger.LogInformation("User {Email} logged in successfully", request.Email);
            return Ok(response);
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error during login for {Email}", request.Email);
            return StatusCode(500, new { message = "An error occurred during login" });
        }
    }

    [HttpPost("register")]
    public async Task<IActionResult> Register([FromBody] RegisterRequest request)
    {
        try
        {
            if (await _userService.UserExistsAsync(request.Email))
            {
                return BadRequest(new { message = "User already exists" });
            }

            var user = await _userService.CreateUserAsync(request.Username, request.Email, request.Password);
            var accessToken = _tokenService.GenerateAccessToken(user);
            var refreshToken = _tokenService.GenerateRefreshToken();

            await _userService.SaveRefreshTokenAsync(user.Id, refreshToken);

            var response = new AuthResponse(
                AccessToken: accessToken,
                RefreshToken: refreshToken,
                Expires: DateTime.UtcNow.AddMinutes(60),
                User: new UserDto(user.Id, user.Username, user.Email, user.Roles)
            );

            return CreatedAtAction(nameof(GetProfile), new { id = user.Id }, response);
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error during registration for {Email}", request.Email);
            return StatusCode(500, new { message = "An error occurred during registration" });
        }
    }

    [HttpPost("refresh")]
    public async Task<IActionResult> RefreshToken([FromBody] RefreshTokenRequest request)
    {
        try
        {
            var principal = _tokenService.GetPrincipalFromExpiredToken(request.AccessToken);
            var userId = int.Parse(principal.FindFirst(ClaimTypes.NameIdentifier)?.Value ?? "0");

            var user = await _userService.GetUserByIdAsync(userId);
            if (user?.RefreshToken != request.RefreshToken || 
                user.RefreshTokenExpiry <= DateTime.UtcNow)
            {
                return Unauthorized(new { message = "Invalid refresh token" });
            }

            var newAccessToken = _tokenService.GenerateAccessToken(user);
            var newRefreshToken = _tokenService.GenerateRefreshToken();

            await _userService.SaveRefreshTokenAsync(user.Id, newRefreshToken);

            var response = new AuthResponse(
                AccessToken: newAccessToken,
                RefreshToken: newRefreshToken,
                Expires: DateTime.UtcNow.AddMinutes(60),
                User: new UserDto(user.Id, user.Username, user.Email, user.Roles)
            );

            return Ok(response);
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error during token refresh");
            return Unauthorized(new { message = "Invalid token" });
        }
    }

    [HttpPost("logout")]
    [Authorize]
    public async Task<IActionResult> Logout()
    {
        try
        {
            var userId = int.Parse(User.FindFirst(ClaimTypes.NameIdentifier)?.Value ?? "0");
            await _userService.RevokeRefreshTokenAsync(userId);
            
            return Ok(new { message = "Logged out successfully" });
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error during logout");
            return StatusCode(500, new { message = "An error occurred during logout" });
        }
    }

    [HttpGet("profile")]
    [Authorize]
    public async Task<IActionResult> GetProfile()
    {
        try
        {
            var userId = int.Parse(User.FindFirst(ClaimTypes.NameIdentifier)?.Value ?? "0");
            var user = await _userService.GetUserByIdAsync(userId);
            
            if (user == null)
                return NotFound();

            var userDto = new UserDto(user.Id, user.Username, user.Email, user.Roles);
            return Ok(userDto);
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting user profile");
            return StatusCode(500, new { message = "An error occurred" });
        }
    }
}
```

### Step 7: Protected Controller Example
```csharp
[ApiController]
[Route("api/[controller]")]
[Authorize] // Requires JWT token
public class UsersController : ControllerBase
{
    private readonly IUserService _userService;

    public UsersController(IUserService userService)
    {
        _userService = userService;
    }

    [HttpGet]
    [Authorize(Roles = "Admin")] // Role-based authorization
    public async Task<IActionResult> GetAllUsers()
    {
        var users = await _userService.GetAllUsersAsync();
        return Ok(users);
    }

    [HttpGet("me")]
    public async Task<IActionResult> GetCurrentUser()
    {
        var userId = int.Parse(User.FindFirst(ClaimTypes.NameIdentifier)?.Value ?? "0");
        var user = await _userService.GetUserByIdAsync(userId);
        return Ok(user);
    }

    [HttpPut("me")]
    public async Task<IActionResult> UpdateCurrentUser([FromBody] UpdateUserRequest request)
    {
        var userId = int.Parse(User.FindFirst(ClaimTypes.NameIdentifier)?.Value ?? "0");
        var user = await _userService.UpdateUserAsync(userId, request.Username, request.Email);
        return Ok(user);
    }
}
```

### Step 8: Custom Authorization Attributes
```csharp
public class RequireClaimAttribute : Attribute, IAuthorizationRequirement
{
    public string ClaimType { get; }
    public string ClaimValue { get; }

    public RequireClaimAttribute(string claimType, string claimValue)
    {
        ClaimType = claimType;
        ClaimValue = claimValue;
    }
}

public class RequireClaimHandler : AuthorizationHandler<RequireClaimAttribute>
{
    protected override Task HandleRequirementAsync(
        AuthorizationHandlerContext context, 
        RequireClaimAttribute requirement)
    {
        if (context.User.HasClaim(requirement.ClaimType, requirement.ClaimValue))
        {
            context.Succeed(requirement);
        }

        return Task.CompletedTask;
    }
}

// Register in Program.cs
builder.Services.AddAuthorization(options =>
{
    options.AddPolicy("RequireAdminRole", policy =>
        policy.RequireRole("Admin"));
    
    options.AddPolicy("RequireManagerClaim", policy =>
        policy.Requirements.Add(new RequireClaimAttribute("department", "manager")));
});

builder.Services.AddScoped<IAuthorizationHandler, RequireClaimHandler>();
```

**[⬆ Back to Top](#table-of-contents)**

---

## 8. Can you tell me about your project and roles and responsibilities?

### Sample Project Description:

**Project Overview:**
"I worked on a comprehensive **E-Commerce Management System** built using **Angular 17** for the frontend and **.NET 8 Web API** for the backend, with **SQL Server** as the database and **Entity Framework Core** for data access."

### Technical Stack & Architecture:
```typescript
// Frontend Technologies
- Angular 17 with TypeScript
- Angular Material UI Components
- RxJS for reactive programming
- NgRx for state management
- Angular Guards for route protection
- Lazy loading for performance optimization

// Backend Technologies  
- .NET 8 Web API
- Entity Framework Core 8
- SQL Server 2022
- AutoMapper for object mapping
- FluentValidation for validation
- Serilog for logging
- Swagger for API documentation
```

### Key Responsibilities:

#### 1. Frontend Development (Angular)
```typescript
// Component Architecture
@Component({
  selector: 'app-product-list',
  template: `
    <mat-card>
      <mat-card-header>
        <mat-card-title>Product Catalog</mat-card-title>
      </mat-card-header>
      
      <mat-card-content>
        <div class="search-filters">
          <mat-form-field>
            <input matInput [(ngModel)]="searchTerm" placeholder="Search products...">
          </mat-form-field>
          
          <mat-select [(value)]="selectedCategory">
            <mat-option *ngFor="let category of categories" [value]="category.id">
              {{category.name}}
            </mat-option>
          </mat-select>
        </div>
        
        <div class="product-grid">
          <mat-card *ngFor="let product of filteredProducts$ | async" class="product-card">
            <mat-card-content>
              <h3>{{product.name}}</h3>
              <p>{{product.price | currency}}</p>
              <button mat-raised-button color="primary" 
                      (click)="addToCart(product)">
                Add to Cart
              </button>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-card-content>
    </mat-card>
  `
})
export class ProductListComponent implements OnInit {
  // Implementation with services, observables, etc.
}
```

#### 2. Backend API Development (.NET Core)
```csharp
// Product Controller
[ApiController]
[Route("api/[controller]")]
[Authorize]
public class ProductsController : ControllerBase
{
    private readonly IProductService _productService;
    private readonly ILogger<ProductsController> _logger;

    public ProductsController(IProductService productService, ILogger<ProductsController> logger)
    {
        _productService = productService;
        _logger = logger;
    }

    [HttpGet]
    [AllowAnonymous]
    public async Task<ActionResult<PagedResult<ProductDto>>> GetProducts(
        [FromQuery] ProductFilter filter)
    {
        try
        {
            var result = await _productService.GetProductsAsync(filter);
            return Ok(result);
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error retrieving products");
            return StatusCode(500, "Internal server error");
        }
    }

    [HttpPost]
    [Authorize(Roles = "Admin,Manager")]
    public async Task<ActionResult<ProductDto>> CreateProduct(CreateProductRequest request)
    {
        var product = await _productService.CreateProductAsync(request);
        return CreatedAtAction(nameof(GetProduct), new { id = product.Id }, product);
    }
}
```

#### 3. Database Design & Entity Framework
```csharp
// Product Entity
public class Product : BaseEntity
{
    public string Name { get; set; } = string.Empty;
    public string Description { get; set; } = string.Empty;
    public decimal Price { get; set; }
    public int StockQuantity { get; set; }
    public int CategoryId { get; set; }
    public Category Category { get; set; } = null!;
    public List<ProductImage> Images { get; set; } = new();
    public List<OrderItem> OrderItems { get; set; } = new();
}

// DbContext Configuration
public class ECommerceDbContext : DbContext
{
    public DbSet<Product> Products { get; set; }
    public DbSet<Category> Categories { get; set; }
    public DbSet<Order> Orders { get; set; }
    public DbSet<User> Users { get; set; }

    protected override void OnModelCreating(ModelBuilder modelBuilder)
    {
        modelBuilder.Entity<Product>(entity =>
        {
            entity.HasKey(p => p.Id);
            entity.Property(p => p.Price).HasColumnType("decimal(18,2)");
            entity.HasOne(p => p.Category)
                  .WithMany(c => c.Products)
                  .HasForeignKey(p => p.CategoryId);
        });
        
        // Seed data
        modelBuilder.Entity<Category>().HasData(
            new Category { Id = 1, Name = "Electronics" },
            new Category { Id = 2, Name = "Clothing" }
        );
    }
}
```

### Major Features Implemented:

#### 1. User Authentication & Authorization
```typescript
// Auth Service (Angular)
@Injectable({ providedIn: 'root' })
export class AuthService {
  private currentUserSubject = new BehaviorSubject<User | null>(null);
  public currentUser$ = this.currentUserSubject.asObservable();

  login(email: string, password: string): Observable<AuthResponse> {
    return this.http.post<AuthResponse>('/api/auth/login', { email, password })
      .pipe(
        tap(response => {
          this.tokenService.setTokens(response.accessToken, response.refreshToken);
          this.currentUserSubject.next(response.user);
        })
      );
  }
}

// JWT Implementation (.NET)
builder.Services.AddAuthentication(JwtBearerDefaults.AuthenticationScheme)
    .AddJwtBearer(options => {
        options.TokenValidationParameters = new TokenValidationParameters
        {
            ValidateIssuerSigningKey = true,
            IssuerSigningKey = new SymmetricSecurityKey(key),
            ValidateIssuer = true,
            ValidateAudience = true,
            ValidIssuer = "your-issuer",
            ValidAudience = "your-audience"
        };
    });
```

#### 2. Shopping Cart Management
```typescript
// Cart Service (Angular)
@Injectable({ providedIn: 'root' })
export class CartService {
  private cartItems = new BehaviorSubject<CartItem[]>([]);
  public cartItems$ = this.cartItems.asObservable();

  addToCart(product: Product, quantity: number 'root'
})
export class DataSharingService {
  private messageSource = new BehaviorSubject<string>('Initial Message');
  currentMessage = this.messageSource.asObservable();
  
  changeMessage(message: string) {
    this.messageSource.next(message);
  }
}

// Component 1
export class Component1 {
  constructor(private dataService: DataSharingService) {}
  
  updateMessage() {
    this.dataService.changeMessage("Message from Component 1");
  }
}

// Component 2
export class Component2 {
  message: string;
  
  constructor(private dataService: DataSharingService) {
    this.dataService.currentMessage.subscribe(message => {
      this.message = message;
    });
  }
}
```

### 4. ViewChild (Direct Access)
```typescript
// Parent Component
@Component({
  template: `
    <app-child #childComponent></app-child>
    <button (click)="callChildMethod()">Call Child Method</button>
  `
})
export class ParentComponent {
  @ViewChild('childComponent') child: ChildComponent;
  
  callChildMethod() {
    this.child.childMethod();
    console.log('Child data:', this.child.childData);
  }
}

// Child Component
export class ChildComponent {
  childData = "Child's data";
  
  childMethod() {
    console.log("Child method called!");
  }
}
```

### 5. Route Parameters & Query Parameters
```typescript
// Navigation Component
export class NavigationComponent {
  constructor(private router: Router) {}
  
  navigateWithData() {
    // Route parameters
    this.router.navigate(['/user', 123]);
    
    // Query parameters
    this.router.navigate(['/search'], { 
      queryParams: { term: 'angular', category: 'tech' } 
    });
  }
}

// Receiving Component
export class UserComponent {
  userId: number;
  
  constructor(private route: ActivatedRoute) {
    // Get route parameter
    this.route.params.subscribe(params => {
      this.userId = +params['id'];
    });
    
    // Get query parameters
    this.route.queryParams.subscribe(queryParams => {
      console.log('Search term:', queryParams['term']);
    });
  }
}
```

**[⬆ Back to Top](#table-of-contents)**

---

## 2. What is Subject and Behavioral Subject? Why we need?

### Subject
A Subject is both an Observable and Observer - it can multicast to many observers.

```typescript
import { Subject } from 'rxjs';

// Create Subject
const subject = new Subject<number>();

// Multiple subscribers
subject.subscribe(value => console.log('Subscriber A:', value));
subject.subscribe(value => console.log('Subscriber B:', value));

// Emit values
subject.next(1);  // Both A and B receive 1
subject.next(2);  // Both A and B receive 2

// Late subscriber won't receive previous values
subject.subscribe(value => console.log('Subscriber C:', value));
subject.next(3);  // All three receive 3
```

### BehaviorSubject
BehaviorSubject requires an initial value and emits current value to new subscribers.

```typescript
import { BehaviorSubject } from 'rxjs';

// Create with initial value
const behaviorSubject = new BehaviorSubject<number>(0);

// First subscriber gets initial value immediately
behaviorSubject.subscribe(value => console.log('Subscriber A:', value)); // 0

behaviorSubject.next(1);  // Subscriber A receives 1

// Late subscriber gets current value immediately
behaviorSubject.subscribe(value => console.log('Subscriber B:', value)); // 1

behaviorSubject.next(2);  // Both receive 2

// Get current value
console.log('Current value:', behaviorSubject.value); // 2
```

### ReplaySubject
ReplaySubject can replay specified number of previous emissions to new subscribers.

```typescript
import { ReplaySubject } from 'rxjs';

// Replay last 2 values
const replaySubject = new ReplaySubject<number>(2);

replaySubject.next(1);
replaySubject.next(2);
replaySubject.next(3);

// New subscriber gets last 2 values
replaySubject.subscribe(value => console.log('Subscriber:', value)); // 2, 3
```

### Why do we need them?

#### 1. Component Communication
```typescript
// Authentication Service
@Injectable({
  providedIn: 'root'
})
export class AuthService {
  private currentUserSubject = new BehaviorSubject<User | null>(null);
  public currentUser$ = this.currentUserSubject.asObservable();
  
  login(user: User) {
    this.currentUserSubject.next(user);
  }
  
  logout() {
    this.currentUserSubject.next(null);
  }
  
  get currentUserValue(): User | null {
    return this.currentUserSubject.value;
  }
}

// Header Component
export class HeaderComponent {
  currentUser: User | null;
  
  constructor(private authService: AuthService) {
    this.authService.currentUser$.subscribe(user => {
      this.currentUser = user;
    });
  }
}
```

#### 2. State Management
```typescript
// Shopping Cart Service
@Injectable({
  providedIn: 'root'
})
export class CartService {
  private cartItems = new BehaviorSubject<CartItem[]>([]);
  public cartItems$ = this.cartItems.asObservable();
  
  addItem(item: CartItem) {
    const currentItems = this.cartItems.value;
    this.cartItems.next([...currentItems, item]);
  }
  
  removeItem(itemId: string) {
    const currentItems = this.cartItems.value;
    const updatedItems = currentItems.filter(item => item.id !== itemId);
    this.cartItems.next(updatedItems);
  }
  
  get itemCount(): number {
    return this.cartItems.value.length;
  }
}
```

#### 3. Real-time Data Updates
```typescript
// Notification Service
@Injectable({
  providedIn: 'root'
})
export class NotificationService {
  private notifications = new Subject<Notification>();
  public notifications$ = this.notifications.asObservable();
  
  showSuccess(message: string) {
    this.notifications.next({
      type: 'success',
      message,
      timestamp: new Date()
    });
  }
  
  showError(message: string) {
    this.notifications.next({
      type: 'error',
      message,
      timestamp: new Date()
    });
  }
}
```

### Key Differences:

| Feature | Subject | BehaviorSubject | ReplaySubject |
|---------|---------|-----------------|---------------|
| Initial Value | No | Required | No |
| Current Value | No access | `.value` property | No direct access |
| Late Subscribers | Get nothing | Get current value | Get buffered values |
| Memory Usage | Low | Low | Higher (buffers values) |

**[⬆ Back to Top](#table-of-contents)**

---

## 3. How do you handle errors globally?

### 1. Global Error Handler
```typescript
import { ErrorHandler, Injectable, Injector } from '@angular/core';
import { HttpErrorResponse } from '@angular/common/http';

@Injectable()
export class GlobalErrorHandler implements ErrorHandler {
  
  constructor(private injector: Injector) {}
  
  handleError(error: Error | HttpErrorResponse): void {
    console.error('Global error caught:', error);
    
    if (error instanceof HttpErrorResponse) {
      // Server error
      this.handleHttpError(error);
    } else {
      // Client-side error
      this.handleClientError(error);
    }
  }
  
  private handleHttpError(error: HttpErrorResponse): void {
    switch (error.status) {
      case 401:
        console.error('Unauthorized access');
        // Redirect to login
        break;
      case 403:
        console.error('Forbidden access');
        break;
      case 404:
        console.error('Resource not found');
        break;
      case 500:
        console.error('Internal server error');
        break;
      default:
        console.error(`HTTP Error: ${error.status} - ${error.message}`);
    }
    
    // Show user notification
    this.showErrorNotification(error.message);
  }
  
  private handleClientError(error: Error): void {
    console.error('Client error:', error.message);
    this.showErrorNotification('Something went wrong. Please try again.');
  }
  
  private showErrorNotification(message: string): void {
    // Implementation depends on your notification system
    // Could be a toast, snackbar, etc.
    alert(`Error: ${message}`);
  }
}

// Register in app.module.ts
@NgModule({
  providers: [
    { provide: ErrorHandler, useClass: GlobalErrorHandler }
  ]
})
export class AppModule {}
```

### 2. HTTP Error Interceptor
```typescript
import { Injectable } from '@angular/core';
import { 
  HttpInterceptor, 
  HttpRequest, 
  HttpHandler, 
  HttpEvent,
  HttpErrorResponse 
} from '@angular/common/http';
import { Observable, throwError } from 'rxjs';
import { catchError, retry } from 'rxjs/operators';

@Injectable()
export class ErrorInterceptor implements HttpInterceptor {
  
  constructor(private notificationService: NotificationService) {}
  
  intercept(request: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {
    return next.handle(request).pipe(
      retry(1), // Retry failed request once
      catchError((error: HttpErrorResponse) => {
        let errorMessage = '';
        
        if (error.error instanceof ErrorEvent) {
          // Client-side error
          errorMessage = `Client Error: ${error.error.message}`;
        } else {
          // Server-side error
          errorMessage = this.getServerErrorMessage(error);
        }
        
        console.error('HTTP Error:', errorMessage);
        this.notificationService.showError(errorMessage);
        
        return throwError(() => error);
      })
    );
  }
  
  private getServerErrorMessage(error: HttpErrorResponse): string {
    switch (error.status) {
      case 401:
        return 'Unauthorized access. Please login again.';
      case 403:
        return 'Access denied. You don\'t have permission.';
      case 404:
        return 'The requested resource was not found.';
      case 500:
        return 'Internal server error. Please try again later.';
      default:
        return error.error?.message || error.message || 'Unknown error occurred';
    }
  }
}

// Register in app.module.ts
@NgModule({
  providers: [
    { 
      provide: HTTP_INTERCEPTORS, 
      useClass: ErrorInterceptor, 
      multi: true 
    }
  ]
})
export class AppModule {}
```

### 3. Service-Level Error Handling
```typescript
@Injectable({
  providedIn: 'root'
})
export class UserService {
  
  constructor(private http: HttpClient) {}
  
  getUsers(): Observable<User[]> {
    return this.http.get<User[]>('/api/users').pipe(
      catchError(this.handleError<User[]>('getUsers', []))
    );
  }
  
  createUser(user: User): Observable<User> {
    return this.http.post<User>('/api/users', user).pipe(
      catchError(this.handleError<User>('createUser'))
    );
  }
  
  private handleError<T>(operation = 'operation', result?: T) {
    return (error: any): Observable<T> => {
      console.error(`${operation} failed:`, error);
      
      // Log to remote logging infrastructure
      this.logError(error);
      
      // Return safe result to keep app running
      return of(result as T);
    };
  }
  
  private logError(error: any): void {
    // Send error to logging service
    console.log('Logging error to service:', error);
  }
}
```

### 4. Component-Level Error Handling
```typescript
@Component({
  selector: 'app-user-list',
  template: `
    <div *ngIf="errorMessage" class="error-message">
      {{ errorMessage }}
      <button (click)="retry()">Retry</button>
    </div>
    
    <div *ngIf="loading">Loading...</div>
    
    <div *ngFor="let user of users">
      {{ user.name }}
    </div>
  `
})
export class UserListComponent {
  users: User[] = [];
  loading = false;
  errorMessage = '';
  
  constructor(private userService: UserService) {}
  
  ngOnInit() {
    this.loadUsers();
  }
  
  loadUsers() {
    this.loading = true;
    this.errorMessage = '';
    
    this.userService.getUsers().subscribe({
      next: (users) => {
        this.users = users;
        this.loading = false;
      },
      error: (error) => {
        this.errorMessage = 'Failed to load users. Please try again.';
        this.loading = false;
        console.error('Component error:', error);
      }
    });
  }
  
  retry() {
    this.loadUsers();
  }
}
```

### 5. Async Error Handling
```typescript
// Using async/await with try-catch
@Component({})
export class UserComponent {
  
  async loadUserData(userId: string) {
    try {
      this.loading = true;
      const user = await this.userService.getUser(userId).toPromise();
      this.user = user;
    } catch (error) {
      console.error('Error loading user:', error);
      this.errorMessage = 'Failed to load user data';
    } finally {
      this.loading = false;
    }
  }
}
```

### 6. Form Validation Errors
```typescript
@Component({
  template: `
    <form [formGroup]="userForm" (ngSubmit)="onSubmit()">
      <input formControlName="email" type="email">
      <div *ngIf="email?.invalid && email?.touched" class="error">
        <div *ngIf="email?.errors?.['required']">Email is required</div>
        <div *ngIf="email?.errors?.['email']">Invalid email format</div>
      </div>
      
      <button type="submit" [disabled]="userForm.invalid">Submit</button>
    </form>
  `
})
export class UserFormComponent {
  userForm = this.fb.group({
    email: ['', [Validators.required, Validators.email]]
  });
  
  constructor(private fb: FormBuilder) {}
  
  get email() {
    return this.userForm.get('email');
  }
  
  onSubmit() {
    if (this.userForm.valid) {
      // Process form
    } else {
      this.markAllFieldsAsTouched();
    }
  }
  
  private markAllFieldsAsTouched() {
    Object.keys(this.userForm.controls).forEach(key => {
      const control = this.userForm.get(key);
      control?.markAsTouched();
    });
  }
}
```

**[⬆ Back to Top](#table-of-contents)**

---

## 4. Where do you store the JWT token in Angular?

### 1. Local Storage (Most Common)
```typescript
// Token Service
@Injectable({
  providedIn: 'root'
})
export class TokenService {
  private readonly TOKEN_KEY = 'jwt_token';
  
  setToken(token: string): void {
    localStorage.setItem(this.TOKEN_KEY, token);
  }
  
  getToken(): string | null {
    return localStorage.getItem(this.TOKEN_KEY);
  }
  
  removeToken(): void {
    localStorage.removeItem(this.TOKEN_KEY);
  }
  
  isTokenExpired(): boolean {
    const token = this.getToken();
    if (!token) return true;
    
    try {
      const payload = JSON.parse(atob(token.split('.')[1]));
      const currentTime = Date.now() / 1000;
      return payload.exp < currentTime;
    } catch {
      return true;
    }
  }
}

// Usage in component
export class LoginComponent {
  constructor(private tokenService: TokenService) {}
  
  onLogin(credentials: any) {
    this.authService.login(credentials).subscribe({
      next: (response) => {
        this.tokenService.setToken(response.token);
        this.router.navigate(['/dashboard']);
      },
      error: (error) => console.error('Login failed:', error)
    });
  }
  
  onLogout() {
    this.tokenService.removeToken();
    this.router.navigate(['/login']);
  }
}
```

### 2. Session Storage
```typescript
@Injectable({
  providedIn: 'root'
})
export class SessionTokenService {
  private readonly TOKEN_KEY = 'session_token';
  
  setToken(token: string): void {
    sessionStorage.setItem(this.TOKEN_KEY, token);
  }
  
  getToken(): string | null {
    return sessionStorage.getItem(this.TOKEN_KEY);
  }
  
  removeToken(): void {
    sessionStorage.removeItem(this.TOKEN_KEY);
  }
}
```

### 3. In-Memory Storage (Most Secure)
```typescript
@Injectable({
  providedIn: 'root'
})
export class InMemoryTokenService {
  private token: string | null = null;
  private tokenSubject = new BehaviorSubject<string | null>(null);
  public token$ = this.tokenSubject.asObservable();
  
  setToken(token: string): void {
    this.token = token;
    this.tokenSubject.next(token);
  }
  
  getToken(): string | null {
    return this.token;
  }
  
  removeToken(): void {
    this.token = null;
    this.tokenSubject.next(null);
  }
  
  hasToken(): boolean {
    return !!this.token;
  }
}
```

### 4. HTTP-Only Cookies (Server-side storage)
```typescript
// This is handled by server, but client can check
@Injectable({
  providedIn: 'root'
})
export class CookieTokenService {
  
  // Server sets HTTP-only cookie
  login(credentials: any): Observable<any> {
    return this.http.post('/api/login', credentials, {
      withCredentials: true // Include cookies in requests
    });
  }
  
  // Check if authenticated (server validates cookie)
  isAuthenticated(): Observable<boolean> {
    return this.http.get<boolean>('/api/auth/check', {
      withCredentials: true
    }).pipe(
      catchError(() => of(false))
    );
  }
  
  logout(): Observable<any> {
    return this.http.post('/api/logout', {}, {
      withCredentials: true
    });
  }
}
```

### 5. Secure Storage Service (Combining approaches)
```typescript
@Injectable({
  providedIn: 'root'
})
export class SecureStorageService {
  private readonly TOKEN_KEY = 'auth_token';
  private readonly REFRESH_TOKEN_KEY = 'refresh_token';
  
  // Use different storage based on security requirements
  setTokens(accessToken: string, refreshToken: string): void {
    // Access token in memory (more secure, lost on refresh)
    this.inMemoryStorage.setToken(accessToken);
    
    // Refresh token in localStorage (persistent)
    localStorage.setItem(this.REFRESH_TOKEN_KEY, refreshToken);
  }
  
  getAccessToken(): string | null {
    return this.inMemoryStorage.getToken();
  }
  
  getRefreshToken(): string | null {
    return localStorage.getItem(this.REFRESH_TOKEN_KEY);
  }
  
  clearTokens(): void {
    this.inMemoryStorage.removeToken();
    localStorage.removeItem(this.REFRESH_TOKEN_KEY);
  }
  
  constructor(private inMemoryStorage: InMemoryTokenService) {}
}
```

### Security Comparison:

| Storage Method | Security | Persistence | XSS Vulnerability | CSRF Vulnerability |
|---------------|----------|-------------|-------------------|-------------------|
| **Local Storage** | Low | High | High | Low |
| **Session Storage** | Low | Medium | High | Low |
| **In-Memory** | High | Low | Low | Low |
| **HTTP-Only Cookie** | High | High | Low | Medium |

### Best Practices:
```typescript
// Complete secure token management
@Injectable({
  providedIn: 'root'
})
export class AuthTokenService {
  private readonly ACCESS_TOKEN_KEY = 'access_token';
  private readonly REFRESH_TOKEN_KEY = 'refresh_token';
  
  // Store access token in memory for security
  private accessToken: string | null = null;
  private tokenSubject = new BehaviorSubject<string | null>(null);
  
  setTokens(accessToken: string, refreshToken: string): void {
    // Access token in memory
    this.accessToken = accessToken;
    this.tokenSubject.next(accessToken);
    
    // Refresh token in secure storage
    localStorage.setItem(this.REFRESH_TOKEN_KEY, refreshToken);
    
    // Set auto-refresh
    this.scheduleTokenRefresh(accessToken);
  }
  
  getAccessToken(): string | null {
    return this.accessToken;
  }
  
  getRefreshToken(): string | null {
    return localStorage.getItem(this.REFRESH_TOKEN_KEY);
  }
  
  private scheduleTokenRefresh(token: string): void {
    try {
      const payload = JSON.parse(atob(token.split('.')[1]));
      const expirationTime = payload.exp * 1000;
      const currentTime = Date.now();
      const refreshTime = expirationTime - currentTime - (5 * 60 * 1000); // 5 min before expiry
      
      if (refreshTime > 0) {
        setTimeout(() => {
          this.refreshToken();
        }, refreshTime);
      }
    } catch (error) {
      console.error('Error scheduling token refresh:', error);
    }
  }
  
  private refreshToken(): void {
    const refreshToken = this.getRefreshToken();
    if (refreshToken) {
      this.authService.refreshToken(refreshToken).subscribe({
        next: (response) => {
          this.setTokens(response.accessToken, response.refreshToken);
        },
        error: () => {
          this.clearTokens();
          // Redirect to login
        }
      });
    }
  }
  
  clearTokens(): void {
    this.accessToken = null;
    this.tokenSubject.next(null);
    localStorage.removeItem(this.REFRESH_TOKEN_KEY);
  }
}
```

**[⬆ Back to Top](#table-of-contents)**

---

## 5. How do you pass JWT token?

JWT tokens can be passed in several ways:

### **Authentication Header (Recommended)**
```typescript
// Angular HTTP Interceptor
@Injectable()
export class AuthInterceptor implements HttpInterceptor {
  intercept(req: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {
    const token = localStorage.getItem('jwt_token');
    
    if (token) {
      const authReq = req.clone({
        setHeaders: {
          Authorization: `Bearer ${token}`
        }
      });
      return next.handle(authReq);
    }
    
    return next.handle(req);
  }
}
```

### **Other Methods:**
- **Query Parameters**: `GET /api/data?token=jwt_token_here`
- **Request Body**: Include in POST/PUT request body
- **Cookies**: Set as HttpOnly cookie (more secure for XSS)

### **Best Practices:**
- Always use HTTPS
- Use Authorization header with Bearer scheme
- Implement token refresh mechanism
- Set appropriate expiration times

**[⬆ Back to Top](#table-of-contents)**

---

## 6. Write a SQL query to find 4th highest salary in employee table

### **Method 1: Using ROW_NUMBER() (Recommended)**
```sql
SELECT salary 
FROM (
    SELECT salary, 
           ROW_NUMBER() OVER (ORDER BY salary DESC) as row_num
    FROM employee
    WHERE salary IS NOT NULL
) ranked
WHERE row_num = 4;
```

### **Method 2: Using DENSE_RANK()**
```sql
SELECT salary 
FROM (
    SELECT salary, 
           DENSE_RANK() OVER (ORDER BY salary DESC) as rank
    FROM employee
    WHERE salary IS NOT NULL
) ranked
WHERE rank = 4;
```

### **Method 3: Using Subquery**
```sql
SELECT DISTINCT salary
FROM employee e1
WHERE 3 = (
    SELECT COUNT(DISTINCT salary)
    FROM employee e2
    WHERE e2.salary > e1.salary
);
```

### **Method 4: Using LIMIT/OFFSET**
```sql
SELECT DISTINCT salary
FROM employee
ORDER BY salary DESC
LIMIT 1 OFFSET 3;
```

**[⬆ Back to Top](#table-of-contents)**

---

## 7. How do you implement JWT in .NET Core?

### **Step 1: Install Required Packages**
```bash
Install-Package Microsoft.AspNetCore.Authentication.JwtBearer
Install-Package System.IdentityModel.Tokens.Jwt
```

### **Step 2: Configure JWT in Program.cs/Startup.cs**
```csharp
// Program.cs (.NET 6+)
using Microsoft.AspNetCore.Authentication.JwtBearer;
using Microsoft.IdentityModel.Tokens;
using System.Text;

var builder = WebApplication.CreateBuilder(args);

// Add JWT Authentication
builder.Services.AddAuthentication(JwtBearerDefaults.AuthenticationScheme)
    .AddJwtBearer(options =>
    {
        options.TokenValidationParameters = new TokenValidationParameters
        {
            ValidateIssuer = true,
            ValidateAudience = true,
            ValidateLifetime = true,
            ValidateIssuerSigningKey = true,
            ValidIssuer = builder.Configuration["Jwt:Issuer"],
            ValidAudience = builder.Configuration["Jwt:Audience"],
            IssuerSigningKey = new SymmetricSecurityKey(
                Encoding.UTF8.GetBytes(builder.Configuration["Jwt:SecretKey"]))
        };
    });

builder.Services.AddAuthorization();

var app = builder.Build();

app.UseAuthentication();
app.UseAuthorization();
```

### **Step 3: JWT Service for Token Generation**
```csharp
public interface IJwtService
{
    string GenerateToken(string userId, string email, IList<string> roles);
}

public class JwtService : IJwtService
{
    private readonly IConfiguration _configuration;

    public JwtService(IConfiguration configuration)
    {
        _configuration = configuration;
    }

    public string GenerateToken(string userId, string email, IList<string> roles)
    {
        var claims = new List<Claim>
        {
            new Claim(ClaimTypes.NameIdentifier, userId),
            new Claim(ClaimTypes.Email, email),
            new Claim(JwtRegisteredClaimNames.Jti, Guid.NewGuid().ToString())
        };

        // Add role claims
        foreach (var role in roles)
        {
            claims.Add(new Claim(ClaimTypes.Role, role));
        }

        var key = new SymmetricSecurityKey(Encoding.UTF8.GetBytes(_configuration["Jwt:SecretKey"]));
        var credentials = new SigningCredentials(key, SecurityAlgorithms.HmacSha256);

        var token = new JwtSecurityToken(
            issuer: _configuration["Jwt:Issuer"],
            audience: _configuration["Jwt:Audience"],
            claims: claims,
            expires: DateTime.UtcNow.AddHours(1),
            signingCredentials: credentials
        );

        return new JwtSecurityTokenHandler().WriteToken(token);
    }
}
```

### **Step 4: Login Controller**
```csharp
[ApiController]
[Route("api/[controller]")]
public class AuthController : ControllerBase
{
    private readonly IJwtService _jwtService;

    public AuthController(IJwtService jwtService)
    {
        _jwtService = jwtService;
    }

    [HttpPost("login")]
    public IActionResult Login([FromBody] LoginModel model)
    {
        // Validate user credentials (implement your logic)
        if (ValidateUser(model.Email, model.Password))
        {
            var roles = GetUserRoles(model.Email);
            var token = _jwtService.GenerateToken("user_id", model.Email, roles);

            return Ok(new { Token = token });
        }

        return Unauthorized();
    }
}
```

### **Step 5: Protect Controllers**
```csharp
[ApiController]
[Route("api/[controller]")]
[Authorize] // Protect entire controller
public class UsersController : ControllerBase
{
    [HttpGet]
    [Authorize(Roles = "Admin")] // Role-based authorization
    public IActionResult GetUsers()
    {
        var userId = User.FindFirst(ClaimTypes.NameIdentifier)?.Value;
        return Ok("Protected data");
    }
}
```

**[⬆ Back to Top](#table-of-contents)**

---

## 8. Can you tell me about your project and roles and responsibilities?

### **Sample Project Response Structure:**

### **Project: E-Commerce Web Application**

**Duration:** January 2023 - Present  
**Team Size:** 6 developers  
**Technology Stack:** Angular 15, .NET Core 6, SQL Server, Azure

### **Project Overview:**
Developed a full-stack e-commerce platform serving 10,000+ users with features including product catalog, shopping cart, payment integration, and admin dashboard.

### **My Roles & Responsibilities:**

#### **Frontend Development (Angular):**
- Designed and developed responsive UI components using Angular Material
- Implemented state management using NgRx for complex application state
- Created reusable components and services for product listing, cart management
- Integrated payment gateways (Stripe, PayPal) with proper error handling
- Implemented lazy loading and performance optimization techniques
- Wrote unit tests using Jasmine and Karma (85% code coverage)

#### **Backend Development (.NET Core):**
- Designed and implemented RESTful APIs following clean architecture principles
- Implemented JWT-based authentication and role-based authorization
- Created Entity Framework Core models and database migrations
- Implemented repository pattern and dependency injection
- Developed background services for order processing and email notifications
- Integrated third-party services (payment processors, email services)

#### **Database Design:**
- Designed normalized database schema for products, orders, users, and inventory
- Created stored procedures for complex reporting queries
- Implemented database indexing for performance optimization
- Set up database backups and migration strategies

#### **Additional Responsibilities:**
- Code reviews and mentoring junior developers
- Participated in Agile ceremonies (standups, sprint planning, retrospectives)
- Collaborated with UI/UX team for design implementation
- Deployed applications to Azure App Service with CI/CD pipelines
- Performance monitoring and bug fixing in production environment

### **Key Achievements:**
- Reduced page load time by 40% through lazy loading implementation
- Improved API response time by 30% through database optimization
- Successfully delivered all sprint deliverables on time
- Zero critical bugs in production for 6 months

**[⬆ Back to Top](#table-of-contents)**

---

## 9. Write an Angular program to print today's date in view and implement a button that shows next day date on click

### **Component TypeScript File (date-display.component.ts):**
```typescript
import { Component } from '@angular/core';

@Component({
  selector: 'app-date-display',
  templateUrl: './date-display.component.html',
  styleUrls: ['./date-display.component.css']
})
export class DateDisplayComponent {
  currentDate: Date = new Date();
  
  constructor() {
    // Initialize with today's date
    this.resetToToday();
  }
  
  // Method to go to next day
  goToNextDay(): void {
    this.currentDate.setDate(this.currentDate.getDate() + 1);
    // Create new Date object to trigger change detection
    this.currentDate = new Date(this.currentDate);
  }
  
  // Method to reset to today's date
  resetToToday(): void {
    this.currentDate = new Date();
  }
  
  // Method to go to previous day
  goToPreviousDay(): void {
    this.currentDate.setDate(this.currentDate.getDate() - 1);
    this.currentDate = new Date(this.currentDate);
  }
  
  // Get formatted date string
  getFormattedDate(): string {
    return this.currentDate.toLocaleDateString('en-US', {
      weekday: 'long',
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    });
  }
  
  // Get short date format
  getShortDate(): string {
    return this.currentDate.toLocaleDateString('en-US');
  }
}
```

### **Template HTML File (date-display.component.html):**
```html
<div class="date-container">
  <h2>Date Display Application</h2>
  
  <!-- Display current date in different formats -->
  <div class="date-display">
    <h3>Current Date:</h3>
    <p class="full-date">{{ getFormattedDate() }}</p>
    <p class="short-date">Short Format: {{ getShortDate() }}</p>
    <p class="iso-date">ISO Format: {{ currentDate | date:'yyyy-MM-dd' }}</p>
  </div>
  
  <!-- Control buttons -->
  <div class="button-group">
    <button 
      class="btn btn-primary" 
      (click)="goToPreviousDay()"
      title="Go to previous day">
      ← Previous Day
    </button>
    
    <button 
      class="btn btn-success" 
      (click)="goToNextDay()"
      title="Go to next day">
      Next Day →
    </button>
    
    <button 
      class="btn btn-secondary" 
      (click)="resetToToday()"
      title="Reset to today">
      Today
    </button>
  </div>
  
  <!-- Additional date information -->
  <div class="date-info">
    <p><strong>Day of Week:</strong> {{ currentDate | date:'EEEE' }}</p>
    <p><strong>Month:</strong> {{ currentDate | date:'MMMM' }}</p>
    <p><strong>Year:</strong> {{ currentDate | date:'yyyy' }}</p>
    <p><strong>Time:</strong> {{ currentDate | date:'HH:mm:ss' }}</p>
  </div>
</div>
```

### **Styling CSS File (date-display.component.css):**
```css
.date-container {
  max-width: 600px;
  margin: 20px auto;
  padding: 20px;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: #f8f9fa;
  border-radius: 10px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.date-container h2 {
  text-align: center;
  color: #333;
  margin-bottom: 30px;
}

.date-display {
  text-align: center;
  margin-bottom: 30px;
  padding: 20px;
  background: white;
  border-radius: 8px;
  border: 1px solid #dee2e6;
}

.full-date {
  font-size: 24px;
  font-weight: bold;
  color: #007bff;
  margin: 10px 0;
}

.short-date, .iso-date {
  font-size: 16px;
  color: #666;
  margin: 5px 0;
}

.button-group {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin-bottom: 20px;
  flex-wrap: wrap;
}

.btn {
  padding: 10px 20px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 500;
  transition: all 0.3s ease;
  min-width: 120px;
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
}

.btn-primary {
  background-color: #007bff;
  color: white;
}

.btn-primary:hover {
  background-color: #0056b3;
}

.btn-success {
  background-color: #28a745;
  color: white;
}

.btn-success:hover {
  background-color: #1e7e34;
}

.btn-secondary {
  background-color: #6c757d;
  color: white;
}

.btn-secondary:hover {
  background-color: #545b62;
}

.date-info {
  background: white;
  padding: 15px;
  border-radius: 8px;
  border: 1px solid #dee2e6;
}

.date-info p {
  margin: 8px 0;
  font-size: 14px;
}

.date-info strong {
  color: #495057;
}

@media (max-width: 480px) {
  .button-group {
    flex-direction: column;
    align-items: center;
  }
  
  .btn {
    width: 200px;
  }
  
  .full-date {
    font-size: 20px;
  }
}
```

### **Module Registration (app.module.ts):**
```typescript
import { NgModule } from '@angular/core';
import { BrowserModule } from '@angular/platform-browser';
import { DateDisplayComponent } from './date-display/date-display.component';

@NgModule({
  declarations: [
    DateDisplayComponent
    // ... other components
  ],
  imports: [
    BrowserModule
    // ... other modules
  ],
  providers: [],
  bootstrap: [/* your bootstrap component */]
})
export class AppModule { }
```

### **Usage in App Component:**
```html
<!-- In app.component.html -->
<app-date-display></app-date-display>
```

**[⬆ Back to Top](#table-of-contents)**

---

## 10. Write a SQL query to delete duplicate records from a table employee

### **Method 1: Using ROW_NUMBER() with CTE (Recommended)**
```sql
-- Keep the record with the lowest ID for each duplicate group
WITH DuplicateCTE AS (
    SELECT *,
           ROW_NUMBER() OVER (
               PARTITION BY first_name, last_name, email, department 
               ORDER BY employee_id ASC
           ) as row_num
    FROM employee
)
DELETE FROM DuplicateCTE 
WHERE row_num > 1;
```

### **Method 2: Using Self-Join**
```sql
-- Delete duplicates keeping the record with minimum employee_id
DELETE e1 FROM employee e1
INNER JOIN employee e2 
WHERE e1.employee_id > e2.employee_id
  AND e1.first_name = e2.first_name
  AND e1.last_name = e2.last_name
  AND e1.email = e2.email
  AND e1.department = e2.department;
```

### **Method 3: Using Window Function with DELETE**
```sql
-- For SQL Server/PostgreSQL
DELETE FROM employee
WHERE employee_id NOT IN (
    SELECT MIN(employee_id)
    FROM employee
    GROUP BY first_name, last_name, email, department
);
```

### **Method 4: Create Temp Table Approach**
```sql
-- Step 1: Create temporary table with unique records
CREATE TABLE #temp_employee AS
SELECT DISTINCT * FROM employee;

-- Step 2: Truncate original table
TRUNCATE TABLE employee;

-- Step 3: Insert unique records back
INSERT INTO employee 
SELECT * FROM #temp_employee;

-- Step 4: Drop temporary table
DROP TABLE #temp_employee;
```

### **Method 5: Using EXCEPT (SQL Server)**
```sql
-- Delete all duplicates, then insert unique records
WITH UniqueRecords AS (
    SELECT DISTINCT * FROM employee
)
DELETE FROM employee;

INSERT INTO employee
SELECT * FROM UniqueRecords;
```

### **Method 6: For MySQL - Using Temporary Variable**
```sql
-- For MySQL (since it doesn't support CTE in older versions)
DELETE e1 FROM employee e1, employee e2
WHERE e1.employee_id > e2.employee_id
  AND e1.first_name = e2.first_name
  AND e1.last_name = e2.last_name
  AND e1.email = e2.email;
```

### **Safe Approach - Backup First:**
```sql
-- 1. Always backup your data first
CREATE TABLE employee_backup AS SELECT * FROM employee;

-- 2. Check duplicates before deletion
SELECT first_name, last_name, email, department, COUNT(*) as duplicate_count
FROM employee
GROUP BY first_name, last_name, email, department
HAVING COUNT(*) > 1;

-- 3. Then proceed with deletion
WITH DuplicateCTE AS (
    SELECT *,
           ROW_NUMBER() OVER (
               PARTITION BY first_name, last_name, email, department 
               ORDER BY employee_id ASC
           ) as row_num
    FROM employee
)
DELETE FROM DuplicateCTE 
WHERE row_num > 1;

-- 4. Verify results
SELECT COUNT(*) as total_records FROM employee;
```

### **Prevention - Add Unique Constraint:**
```sql
-- Add unique constraint to prevent future duplicates
ALTER TABLE employee 
ADD CONSTRAINT UK_employee_unique 
UNIQUE (first_name, last_name, email, department);
```

**[⬆ Back to Top](#table-of-contents)**

---
